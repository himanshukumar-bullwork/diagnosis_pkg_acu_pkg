nav2_diag:
  namespace: ""
  publish_hz: 2.0
  debounce_s: 2.0
  rollup: worst_of_components
  tf_age_warn_s: 0.3
  tf_age_error_s: 0.8

  idle:
    gate_cmd_vel: true
    tf_age_warn_s: 2.0
    tf_age_error_s: 5.0

  components:

    bt_navigator:
      hardware_id: "nav2"
      node_name: "bt_navigator"
      action_server: "/navigate_to_pose"
      topics:
        behavior_tree_log: "/behavior_tree_log"
      thresholds:
        behavior_rate_warn_hz: 50.0
        behavior_rate_error_hz: 10.0
      tf_required: []
      lifecycle:
        expected_state: "active"
        check_period_s: 2.0
        not_active_warn: true
      # must exist in param: bt_navigator.plugin_lib_names
      plugins_required:
        - nav2_compute_path_to_pose_action_bt_node
        - nav2_compute_path_through_poses_action_bt_node
        - nav2_smooth_path_action_bt_node
        - nav2_follow_path_action_bt_node
        - nav2_spin_action_bt_node
        - nav2_wait_action_bt_node
        - nav2_assisted_teleop_action_bt_node
        - nav2_back_up_action_bt_node
        - nav2_drive_on_heading_bt_node
        - nav2_clear_costmap_service_bt_node
        - nav2_is_stuck_condition_bt_node
        - nav2_goal_reached_condition_bt_node
        - nav2_goal_updated_condition_bt_node
        - nav2_globally_updated_goal_condition_bt_node
        - nav2_is_path_valid_condition_bt_node
        - nav2_initial_pose_received_condition_bt_node
        - nav2_reinitialize_global_localization_service_bt_node
        - nav2_rate_controller_bt_node
        - nav2_distance_controller_bt_node
        - nav2_speed_controller_bt_node
        - nav2_truncate_path_action_bt_node
        - nav2_truncate_path_local_action_bt_node
        - nav2_goal_updater_node_bt_node
        - nav2_recovery_node_bt_node
        - nav2_pipeline_sequence_bt_node
        - nav2_round_robin_node_bt_node
        - nav2_transform_available_condition_bt_node
        - nav2_time_expired_condition_bt_node
        - nav2_path_expiring_timer_condition
        - nav2_distance_traveled_condition_bt_node
        - nav2_single_trigger_bt_node
        - nav2_goal_updated_controller_bt_node
        - nav2_is_battery_low_condition_bt_node
        - nav2_navigate_through_poses_action_bt_node
        - nav2_navigate_to_pose_action_bt_node
        - nav2_remove_passed_goals_action_bt_node
        - nav2_planner_selector_bt_node
        - nav2_controller_selector_bt_node
        - nav2_goal_checker_selector_bt_node
        - nav2_controller_cancel_bt_node
        - nav2_path_longer_on_approach_bt_node
        - nav2_wait_cancel_bt_node
        - nav2_spin_cancel_bt_node
        - nav2_back_up_cancel_bt_node
        - nav2_assisted_teleop_cancel_bt_node
        - nav2_drive_on_heading_cancel_bt_node
        - nav2_is_battery_charging_condition_bt_node
        - nav2_progress_checker_selector_bt_node

    planner_server:
      hardware_id: "nav2"
      node_name: "planner_server"
      action_server: "/compute_path_to_pose"
      topics_required:
        global_costmap: "/global_costmap/costmap"
      thresholds:
        global_costmap_rate_warn_hz: 0.5
        global_costmap_rate_error_hz: 0.1
        global_costmap_stale_s: 3.0
      tf_required: []
      lifecycle:
        expected_state: "active"
        check_period_s: 2.0
        not_active_warn: true
      # must exist in params:
      # - planner_server.planner_plugins includes these IDs
      # - <ID>.plugin_lib_name equals one of libs[ID]
      plugins_required:
        ids: ["GridBased"]
        libs:
          GridBased:
            - "nav2_navfn_planner/NavfnPlanner"
            - "nav2_smac_planner/SmacPlannerHybrid"
            - "nav2_smac_planner/SmacPlannerLattice"

    controller_server:
      hardware_id: "nav2"
      node_name: "controller_server"
      action_server: "/follow_path"
      topics:
        cmd_vel: "/cmd_vel"
      thresholds:
        cmd_vel_rate_warn_hz: 10.0
        cmd_vel_stale_s: 0.5
      tf_required: []
      lifecycle:
        expected_state: "active"
        check_period_s: 2.0
        not_active_warn: true
      # must exist in params:
      # - controller_server.controller_plugins includes these IDs
      # - <ID>.plugin_lib_name equals one of libs[ID]
      plugins_required:
        ids: ["FollowPath"]
        libs:
          FollowPath:
            - "nav2_regulated_pure_pursuit_controller/RegulatedPurePursuitController"
            - "dwb_core/DWBLocalPlanner"  #mppi addition to be done
            

    smoother_server:
      hardware_id: "nav2"
      node_name: "smoother_server"
      action_server: "/smooth_path"
      thresholds: {}
      tf_required: []
      lifecycle:
        expected_state: "active"
        check_period_s: 2.0
        not_active_warn: true
      # must exist in params:
      # - smoother_server.smoother_plugins includes these IDs
      # - <ID>.plugin_lib_name equals one of libs[ID]
      plugins_required:
        ids: ["SmoothPath"]
        libs:
          SmoothPath:
            - "nav2_smoother/ConstrainedSmoother"

    behavior_server:
      hardware_id: "nav2"
      node_name: "behavior_server"
      topics_required:
        local_costmap_raw: "/local_costmap/costmap_raw"
        global_costmap_raw: "/global_costmap/costmap_raw"
      thresholds:
        local_costmap_raw_rate_warn_hz: 0.5
        local_costmap_raw_rate_error_hz: 0.1
        local_costmap_raw_stale_s: 2.0
        global_costmap_raw_rate_warn_hz: 0.5
        global_costmap_raw_rate_error_hz: 0.1
        global_costmap_raw_stale_s: 3.0
      tf_required: []
      lifecycle:
        expected_state: "active"
        check_period_s: 2.0
        not_active_warn: true
      # optionally enforce behavior plugins here
      plugins_required:
        ids: []
        libs: {}

  # ---------- blame rules: set suspect / confidence / evidence ----------
  blame_rules:
    # Controller stalled and local costmap stale → blame local_costmap
    - when:
        controller_server: ["ERROR", "STALE"]
        local_costmap: ["ERROR", "STALE"]
      set:
        suspect: "local_costmap"
        confidence: 0.9
        evidence: "controller stalled while local costmap not updating"

    # Planner errors with slow/old global costmap → blame global_costmap
    - when:
        planner_server: ["ERROR"]
        global_costmap: ["WARN", "STALE", "ERROR"]
      set:
        suspect: "global_costmap"
        confidence: 0.85
        evidence: "planner failed and global costmap unhealthy"

    # Critical BT plugin missing → blame bt_navigator
    - when_plugins_missing:
        bt_navigator:
          any_of:
            - "nav2_follow_path_action_bt_node"
            - "nav2_navigate_to_pose_action_bt_node"
      set:
        suspect: "bt_navigator"
        confidence: 0.95
        evidence: "required BT plugin(s) not loaded"

    # Planner plugin ID missing or wrong library → blame planner_server
    - when_plugin_id_mismatch:
        planner_server:
          ids: ["GridBased"]
      set:
        suspect: "planner_server"
        confidence: 0.9
        evidence: "planner plugin IDs or libraries mismatch"

    # Controller plugin ID missing or wrong library → blame controller_server
    - when_plugin_id_mismatch:
        controller_server:
          ids: ["FollowPath"]
      set:
        suspect: "controller_server"
        confidence: 0.9
        evidence: "controller plugin IDs or libraries mismatch"

    # Fallback: if any component is ERROR, but nothing matched above
    - when_any_error: ["bt_navigator", "planner_server", "controller_server", "smoother_server", "behavior_server"]
      set:
        suspect: "unknown"
        confidence: 0.5
        evidence: "at least one component in ERROR; no specific rule matched"

    # Final default
    - default:
        suspect: "none"
        confidence: 0.0
        evidence: "all components OK/WARN only"
